<!-- ./public/player/edit.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Player</title>
    <link rel="stylesheet" href="/styles.css">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const url = new URL(window.location.href)
            const propertyId = url.pathname.split('/')[2];
            const modifyhousing = document.getElementById('modifyhousing');

            modifyhousing.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent the default form submission

                // Perform your client-side validation here
                const landlordId = document.getElementById('landlordId');
                const address = document.getElementById('address');
                const numberOfRooms = document.getElementById('numberOfRooms');
                const rent = document.getElementById('rent');
                const securityDeposit= document.getElementById('securityDeposit');
                const summary = document.getElementById('summary');
                const nickname = document.getElementById('nickname');
                const location = document.getElementById('location' );
                const taken = document.getElementById('taken');

                // Construct the request body
                const requestBody = {
                        landlordId: landlordId.value,
                        address: address.value,
                        numberOfRooms: numberOfRooms.value,
                        rent: rent.value, 
                        securityDeposit: securityDeposit.value, 
                        summary: summary.value,
                        nickname: nickname.value,
                        location: location.value,
                        taken: taken.value
                        // redirect: '/players.html', not sure whethe is going?
                    };
                // Send the data to the server using fetch
                try {
                    const response = await fetch(`'/api/property/${propertyId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody),
                    });

                    if (response.ok) {
                        // Form submission successful, you can redirect the user
                        // const landlordId = document.getElementById('landlordId');
                        // console.log(`propertyId with ID ${propertyId} modified successfully`);
                        // window.location.href = `/users/${userId}/list_property.html`;
                        // this has problem
                    } else {
                        const errorData = await response.json();
                        alert(`Server Error: ${errorData.message}`);
                    }
                } catch (error) {
                    alert('An error occurred while communicating with the server.');
                }
            });
        });
    </script>
</head>
<body>
        <h1>Edit Property</h1>
        <form id="modifyhousing">
            <label for="landlordId">Landlord ID:</label>
            <input type="text" id="landlordId" name="landlordId" required>
            <br>
            <label for="address">address:</label>
            <input type="text" id="address" name="address" required> 
            <br>
            <label for="numberOfRooms">numberOfRooms:</label>
            <input type="number" id="numberOfRooms" name="numberOfRooms" required>
            <br> 
            <label for="rent">rent:</label>
            <input type="number" id="rent" name="rent" required> 
            <br>
            <label for="securityDeposit">securityDeposit:</label>
            <input type="number" id="securityDeposit" name="securityDeposit" required>
            <br> 
            <label for="summary">summary:</label>
            <input type="text" id="summary" name="summary" required> 
            <br>
            <label for="nickname">nickname:</label>
            <input type="text" id="nickname" name="nickname" required> 
            <br>
            <label for="location">location:</label>
            <select id="location" name="location" required> 
                <option value="downtown">Downtown</option>
                <option value="ktown">Ktown</option>
                <option value="UPS">UPS area</option>
            </select>
            <br>
            <label for="taken">Taken:</label>
            <input type="checkbox" id="taken" name="taken">
            <!-- Other input fields for creating a new property -->
    
        </form>
            <input type="hidden" name="redirect" value="/players.html">
            <button type="submit"> Save Changes </button>
        </form>
        
        <button class="deleteButton">Delete</button>

        <script>
            const deleteButtons = document.querySelectorAll('.deleteButton');
            // Add event listener for each delete button of each student user
            deleteButtons.forEach(button => {
                button.addEventListener('click', async () => {
                    const propertyId = url.pathname.split('/')[2];
                    const landlordId = document.getElementById('landlordId');
                    // const studentId = button.getAttribute('data-student-id');
                    console.log("test delete button");

                    try {
                        const response = await fetch(`/api/property/${propertyId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });

                        if (response.ok) {
                            console.log(`propertyId with ID ${propertyId} deleted successfully`);
                            document.getElementById('error-message').innerText = `propertyId User with ID ${propertyId} deleted successfully`;
                            window.location.href = `/users/${userId}/list_property.html`; // Replace userId with the actual user ID
                            setTimeout(() => {
                                location.reload();
                            }, 80);
                        } else {
                            console.error(`Failed to delete student with ID ${studentId}`);
                            document.getElementById('error-message').innerText = `Failed to delete student with ID ${studentId}`;
                        }
                    } catch (error) {
                        console.error('Error:', error);
                    }
                });
            });
    
        </script>
    </body>
</html>
