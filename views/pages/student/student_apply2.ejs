<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Apply for Property</title>
    <!-- Any additional stylesheets or scripts can be included here -->
    <script>            
       document.addEventListener('DOMContentLoaded', async() => {
            const url = new URL(window.location.href)
            const propertyId = url.pathname.split('/')[2];
            console.log(propertyId)

            // try{                    
            //     fetch(`/api/property?propertyId=${propertyId}`)
            //     .then(response => response.json())
            //     .then(showing)
            //     .catch(error => {
            //         console.error('Error fetching data:', error);
            //     });
            //     ;
            //     }catch (error) {
            //         alert('An error occurred while communicating with the server.');
            //     }

            ApplyForm.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent the default form submission

                // Perform your client-side validation here
                // const propertyId = document.getElementById('propertyId');
                const url = new URL(window.location.href)
                const propertyId = url.pathname.split('/')[2];
                const studentId = document.getElementById('studentId');

                // Construct the request body
                const requestBody = {
                    propertyId: propertyId.value,
                    studentId: studentId.value,
                };

                // Send the data to the server using fetch
                try {
                    const response = await fetch(`/api/application`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody),
                    });

                    if (response.ok) {
                        // Form submission successful, you can redirect the user
                        window.location.href = '/api/student/list_property.html';
                        // checknig the the href is right or not.
                    } else {
                        const errorData = await response.json();
                        alert(`Server Error: ${errorData.message}`);
                    }
                } catch (error) {
                    alert('An error occurred while communicating with the server.');
                }
            });
        });
</script>
</head>

<body>
    <h1>Property Information</h1>
    <table border="1">
        <tr>
            <th>Landlord ID</th>
            <th>Address</th>
            <th>Number of Rooms</th>
            <th>Rent</th>
            <th>Security Deposit</th>
            <th>Summary</th>
            <th>Location</th>
        </tr>
        <tr>
            <!-- Replace these placeholders with actual property data -->
            <td><%= property.landlordId %></td>
            <td><%= property.address %></td>
            <td><%= property.numberOfRooms %></td>
            <td><%= property.rent %></td>
            <td><%= property.securityDeposit %></td>
            <td><%= property.summary %></td>
            <td><%= property.location %></td>
        </tr>
    </table>

    <h2>Apply for this Property</h2>
    <form id="ApplyForm" action="/api/application" method="POST">
        <p>Please enter your userID and submit it after reviewing.</p>
        <label for="studentId">Student ID:</label>
        <input type="text" id="studentId" name="studentId" required>
        <br>
        <br>
        <input type="hidden" name="propertyId" value="<%= property._id %>"> <!-- Assuming you need the property ID for the application -->
        <button type="submit">Apply</button>
    </form>

    <!-- Any additional content or scripts can be included here -->
</body>

</html>
