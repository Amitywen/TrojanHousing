<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Your existing meta tags -->
    <style>
        /* Your existing CSS styles */
        .container {
            display: flex;
            justify-content: center;
            /* align-items: center; */
            height: 100vh; /* Adjust as needed */
            font-family: 'Courier New', Courier, monospace;
        }

        table {
            border-collapse: separate;
            border-spacing: center;
            margin-top: 20px; /* Adjust top margin as needed */
            width:100%
        }

        td, th {
            vertical-align: middle;
        }

        .selection {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            font-family: 'Courier New', Courier, monospace;
            margin: 10px;
        }

        .selection select {
            margin-left: 20px;
            margin-right: 20px;
        }
    </style>
</head>

<body>
    <!-- <h1>Housing List</h1> -->
    
    <% if (players.length === 0) { %>
        <p>No players available.</p>
    <% } else { %>
        <!-- <input id="search-box" type="text" placeholder="Search by name"> -->
        <div class = selection>
            <h4>Location</h4>
            <select id="Location">
            <option value="downtown">Downtown</option>
            <option value="ktown">Ktown</option>
            <option value="UPS">UPS area</option>
            <!-- <option value="false">Unavaliable Housing</option> -->
            </select><br></br>

            <h4>House type</h4>
            <select id="Housetype">
            <option value="house">House</option>
            <option value="Townhome">Townhome</option>
            <option value="Apartment">Apartment</option>
            <option value="Studio">Studio</option>
            <!-- <option value="false">Unavaliable Housing</option> -->
            </select><br></br>
        </div>

        <div class="container">
            <table>
                <thead>
                    <tr>
                        <th>id</th>
                        <th>Location</th>
                        <th>House type</th>
                        <th>Price (USD)</th>
                        <th>Apply</th>
                    </tr>
                </thead>
                <tbody class="housing-list">
                    <% housings.forEach((unit) => { %>
                        <tr>
                            <td><%= unit.pid %></td>
                            <td><%= unit.location %></td>
                            <td><%= unit.housetype %></td>
                            <td><%= unit.price %></td>
                            <td><a href="/api/<%= unit.pid %>/apply.html">Apply</a></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    <% } %>

    <script>

        document.getElementById('location').addEventListener('change', (event) => {
            const houseType = document.getElementById('Housetype').value;

            const selectedValue = event.target.value;
            let apiUrl = '/api/property';
            apiUrl += `?location=${selectedValue}`;

            if (houseType !== '*') {
                apiUrl += `&houseType=${houseType}`;
            }

            fetch(apiUrl)
                .then(response => response.json())
                .then(replaceHousingList)
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        });

        document.getElementById('houseType').addEventListener('change', (event) => {
            const location = document.getElementById('Location').value;

            const selectedValue = event.target.value;
            let apiUrl = '/api/property';
            apiUrl += `?houseType=${selectedValue}`;

            if (location !== '*') {
            apiUrl += `&location=${location}`;
            }

            fetch(apiUrl)
                .then(response => response.json())
                .then(replaceHousingList)
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        });

        function replaceHousingList(housing) {
            const Housinglist = document.querySelector('.housing-list');
            Housinglist.innerHTML = ''; // Clear the existing content

            hosuing.forEach((unit) => {
                const houseRow = document.createElement('tr');
                houseRow.innerHTML = `
                    <td>${unit.pid}</td>
                    <td>${unit.location}</td>
                    <td>${unit.housetype}</td>
                    <td>${unit.price}</td>
                    <td><a href="/api/${unit.pid}/apply.html">Apply</a></td>
                `;
                Housinglist.appendChild(houseRow);
            });
        }
    </script>
    <!-- <a href="/player/create.html">Create New Player</a> -->
</body>
</html>
