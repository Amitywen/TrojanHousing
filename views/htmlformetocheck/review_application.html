

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Property Applications</title>
  <!-- Add any necessary styles or scripts here -->
  <style>
    .whole-page-background-image{
       height: 80vh;
       width: 100vw;
       background-image: url('/images/USC_Village.jpg');
       /* background-color: rgba(255,255,255,0.5); */
       background-size: cover;
       background-position: center;
       background-repeat: no-repeat;
   }
   .whole-page-background-color{
       height: 80vh;
       width: 100vw;
       /* background-image: url('/images/USC_great_lawn.jpg'); */
       background-color: rgba(255,255,255,0.6);
       background-size: cover;
       background-position: center;
       background-repeat: no-repeat;
   }
</style>
</head>
<body>
    <div class="whole-page-background-color">
            <!-- <h1 class="admin-page-title">A Landlord User List</h1> -->
    <h1 class="admin-page-title">Applications for Property ID: <%= propertyId %></h1>
    <!-- propertyId, applications -->
        <div class="admin-list">
            <% if (applications.length > 0) { %>
                <table id="user-list" class="styled-table">
                    <thread>
                        <th style="padding-right: 15px">#</th>
                        <th style="padding-right: 15px">Application ID</th>
                        <th style="padding-right: 15px">Created At</th>
                        <th style="padding-right: 15px">Student ID</th>
                        <th style="padding-right: 15px">Status</th>
                        <th style="padding-right: 15px">Accept?</th>
                    </thread>
                    <% let rowCount = 1; %>
                    <% applications.forEach(application => { %>
                        <tr name="user" style="height: 20px">
                            <td style="padding-right: 15px"><%=  rowCount %></td> 
                            <td style="padding-right: 15px"><%= application._id %></td>
                            <td style="padding-right: 15px"><%= application.created_at %></td>
                            <td style="padding-right: 15px"><%= application.studentId %></td>
                            <td style="padding-right: 15px"><%= application.accepted ? 'Yes' : 'No' %></td>
                            <td><button class="Accept" application-id="<%= application._id %>">Accept</button></td>
                        </tr>
                        <% rowCount++; %>
                    <% }); %>
                </table>
            <% } else { %>
                <p>No applications found for this property ID.</p>
            <% } %>
        
        </div>
    </div>
    <script>
            const Accept = document.querySelectorAll('.Accept');
    // Add event listener for each delete button of each student user
    Accept.forEach(button => {
        button.addEventListener('click', async () => {
            const applicationID = button.getAttribute('application._id');
            // console.log("test delete button");

            try {
                const response = await fetch(`/api/application/${applicationID}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {
                    console.log(`Application: ${applicationID} Accepted`);
                    document.getElementById('error-message').innerText = `Application: ${applicationID} Accepted`;
                    setTimeout(() => {
                        location.reload();
                    }, 100);
                    window.location.href = '/api/property/application/${applicationID}';
                } else {
                    console.error(`Failed to delete landlord with ID ${userId}`);
                    document.getElementById('error-message').innerText = `Failed to accept Application: ${applicationID}`;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    });
    </script>
  <!-- Add any additional content or scripts here -->
</body>
</html>
